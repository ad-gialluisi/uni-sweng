@startuml

!include skin.h

actor Cicerone
boundary vistaItinerario
control controlloreItinerario
control modelloItinerario
participant ciceroneDatabase

Cicerone -> vistaItinerario : elabora(dati)
activate vistaItinerario
vistaItinerario -> controlloreItinerario : richiediAnnullamentoRichPartec(dati)

note right of vistaItinerario : nomi dei metodi ridotti per\nquestioni di lettura

activate controlloreItinerario
controlloreItinerario -> controlloreItinerario : validaParametri(dati)
activate controlloreItinerario

alt I dati sono validi
    controlloreItinerario -> modelloItinerario : annullaRichPartec(idRichiesta)
    activate modelloItinerario
    modelloItinerario -> ciceroneDatabase : manipola(rimozioneRichPartec)
    note right of modelloItinerario : La richiesta di partecipazione\nprima della rimozione era nello\nstato "annullanda"
    activate ciceroneDatabase
    deactivate ciceroneDatabase
    controlloreItinerario <<-- modelloItinerario : codiceStato
    deactivate modelloItinerario
else
    controlloreItinerario -> controlloreItinerario : set(codiceStato, OPERAZIONE_FALLITA)
end
deactivate controlloreItinerario

controlloreItinerario -> controlloreItinerario : setStatoOperazione(codiceStato)
controlloreItinerario -> controlloreItinerario : setMessaggio(codiceStato)

vistaItinerario -> controlloreItinerario : getStatoOperazione()
vistaItinerario <<-- controlloreItinerario : statoOperazione

opt L'operazione Ã¨ andata a buon fine
    vistaItinerario -> vistaItinerario : aggiornaVisualizzazioneRichieste()
end

@enduml
