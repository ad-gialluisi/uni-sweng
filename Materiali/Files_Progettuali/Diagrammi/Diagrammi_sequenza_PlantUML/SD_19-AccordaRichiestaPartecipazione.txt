@startuml

!include skin.h

actor Cicerone
boundary vistaItinerario
control controlloreItinerario
control modelloItinerario
participant ciceroneDatabase

Cicerone -> vistaItinerario : elabora(dati)
activate vistaItinerario
vistaItinerario -> controlloreItinerario : richiediAccordoRichPartec(dati)

note right of vistaItinerario : nomi dei metodi ridotti per\nquestioni di lettura

activate controlloreItinerario
controlloreItinerario -> controlloreItinerario : validaParametri(dati)
activate controlloreItinerario


alt I dati sono validi
    controlloreItinerario -> modelloItinerario : accordaRichPartec(idRichiesta)
    activate modelloItinerario
    modelloItinerario -> ciceroneDatabase : manipola(impostaStatoRichAccordata)
    note right of modelloItinerario : La richiesta di partecipazione\nprima dell'accordo era nello\nstato "accordanda"
    activate ciceroneDatabase
    deactivate ciceroneDatabase
    controlloreItinerario <<-- modelloItinerario : codiceStato
    deactivate modelloItinerario
else
    controlloreItinerario -> controlloreItinerario : set(codiceStato, OPERAZIONE_FALLITA)
end
deactivate controlloreItinerario


controlloreItinerario -> controlloreItinerario : setStatoOperazione(codiceStato)
controlloreItinerario -> controlloreItinerario : setMessaggio(codiceStato)

vistaItinerario -> controlloreItinerario : getStatoOperazione()
vistaItinerario <<-- controlloreItinerario : statoOperazione

opt L'operazione Ã¨ andata a buon fine
    vistaItinerario -> vistaItinerario : aggiornaVisualizzazioneRichieste()
end


@enduml
